{% extends 'base.html' %}

{% block title %}Edit Journal Entry{% endblock %}

{% block content %}
<div class="journal-editor">
    <div class="editor-container">
        <h1>Edit Journal Entry</h1>
        <form method="POST" action="{{ url_for('edit_journal_entry', entry_id=entry.id) }}">
            <div class="typography-controls">
                <div class="control-box">
                <label for="fontSelect">Font:</label>
                <select id="fontSelect">
                    <option value="Arial, sans-serif">Arial</option>
                    <option value="'Courier New', monospace">Courier New</option>
                    <option value="Georgia, serif">Georgia</option>
                    <option value="'Times New Roman', serif">Times New Roman</option>
                    <option value="Verdana, sans-serif">Verdana</option>
                </select>
            </div>

            <div class="control-box">
                <label for="entryType">Entry Type:</label>
                <select id="entryType" name="type"> 
                    <option value="daily">Daily Reflection</option>
                    <option value="gratitude">Gratitude</option>
                    <option value="goals">Goals</option>
                    <option value="dream">Dream Journal</option>
                    <option value="freewrite">Free Write</option>
                </select>
            </div>

            <div class="control-box">
                <label for="moodSelect">Mood:</label>
                <select id="moodSelect" name="mood">
                    <option value="">No Mood</option>
                    <option value="happy">Happy</option>
                    <option value="sad">Sad</option>
                    <option value="angry">Angry</option>
                    <option value="calm">Calm</option>
                    <option value="excited">Excited</option>
                    <option value="stressed">Stressed</option>
                </select>
            </div>

            <div class="control-box">
                <label for="fontSize">Font Size:</label>
                <input type="number" id="fontSize" value="16" min="8" max="72">
            </div>

            <div class="control-box">
                <label for="lineHeight">Line Height:</label>
                <input type="number" id="lineHeight" value="24" min="12" max="100">
            </div>

        </div>

        <div class="control-box">
                <label for="datePosted">Entry Date:</label>
                <input type="date" id="datePosted" name="date_posted"  required>
        </div>

        <div class="char-count" id="charCount">0 characters</div>

            <input type="text" name="title" placeholder="Entry Title" value="{{ entry.title }}" required>
            <textarea id="journalText" name="content" placeholder="Start writing..." rows="10">{{ entry.content }}</textarea>
            {# Hidden input for sketch_data - will be populated by JS #}
            <input type="hidden" id="sketchDataInput" name="sketch_data" value="{{ entry.sketch_data or '' }}">

            <div class="sketchpad-section">
                <h3>Sketchpad</h3>
                <div class="sketchpad-controls-top">
                    <label for="penColor">Pen Color:</label>
                    <input type="color" id="penColor" value="#000000">
                    <label for="penSize">Pen Size:</label>
                    <input type="range" id="penSize" min="1" max="10" value="2">
                    <span id="penSizeValue">2</span>
                </div>
                <canvas id="sketchpad" width="600" height="300" style="border:1px solid #ccc; background:white;"></canvas>
                <div class="sketchpad-controls-bottom">
                    <button type="button" id="clearSketch">Clear Sketch</button>
                    <button type="button" id="addStickerBtn">Use as Sticker</button>
                </div>
            </div>

            <div class="sticker-container" id="stickerContainer">
                <h3>Interactive Stickers</h3>
                <p>Drag and drop stickers here, or drag them into the journal text.</p>
            </div>

            <div class="btn-field">
                <button type="submit">Update Entry</button>
            </div>
        </form>
    </div>
</div>

<script>
    const textarea = document.getElementById('journalText');
    const fontSelect = document.getElementById('fontSelect');
    const fontSizeInput = document.getElementById('fontSize');
    const lineHeightInput = document.getElementById('lineHeight');
    const charCount = document.getElementById('charCount');
    const datePostedInput = document.getElementById('datePosted'); // Get date input

    // Set default date to today's date if not already set by Flask
        if (!datePostedInput.value) {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
            const dd = String(today.getDate()).padStart(2, '0');
            datePostedInput.value = `${yyyy}-${mm}-${dd}`;
        }
    

    // Typography
    fontSelect.addEventListener('change', () => {
        textarea.style.fontFamily = fontSelect.value;
    });

    fontSizeInput.addEventListener('input', () => {
        textarea.style.fontSize = fontSizeInput.value + 'px';
    });

    lineHeightInput.addEventListener('input', () => {
        textarea.style.lineHeight = lineHeightInput.value + 'px';
    });

    // Character count
    textarea.addEventListener('input', () => {
        charCount.textContent = textarea.value.length + ' characters';
    });
</script>


{% endblock %}